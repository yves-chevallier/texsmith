# `texsmith build`

`texsmith build` extends the conversion pipeline by invoking `latexmk` to produce a finished PDF. It relies on a LaTeX template to define the document preamble and output structure.

```bash
texsmith build [OPTIONS] INPUT...
```

## Positional Arguments

| Argument | Description |
| -------- | ----------- |
| `INPUT...` | A single Markdown or HTML document to compile. The command expects exactly one document and optional BibTeX files (either positional or via `--bibliography`). |

## Options

The following table lists every option specific to `build`. Many options mirror those available in [`texsmith convert`](convert.md) and behave identically.

| Option | Description |
| ------ | ----------- |
| `--output-dir/-o PATH` | Destination directory for TeX files, logs, caches, and the compiled PDF. Defaults to `build/`. TeXSmith creates the directory if it does not exist. |
| `--selector TEXT` | CSS selector used to extract the article content from HTML inputs. Defaults to `article.md-content__inner`. |
| `--full-document / --no-full-document` | Converts the entire HTML file instead of extracting a section via `--selector`. |
| `--base-level INTEGER` | Shifts detected heading levels before rendering. |
| `--heading-level/-h INTEGER` | Adds an additional offset to headings at render time. |
| `--drop-title / --keep-title` | Drops the first heading to avoid duplicate titles when the template already renders one. |
| `--numbered / --unnumbered` | Toggles section numbering in the final LaTeX document. |
| `--parser TEXT` | Chooses the BeautifulSoup parser (`html.parser`, `lxml`, etc.). |
| `--no-fallback-converters` | Disables installation of placeholder converters. Missing dependencies will therefore cause the command to fail. |
| `--copy-assets / --no-copy-assets` | Controls whether assets are copied into the output directory. |
| `--manifest / --no-manifest` | Toggles manifest generation (reserved for future workflows). |
| `--template/-t PATH_OR_NAME` | **Required.** Selects the LaTeX template used for wrapping the generated content. \
Without this option the build command aborts. |
| `--debug-html / --no-debug-html` | Persists the intermediate HTML snapshot (`*.debug.html`). |
| `--classic-output / --rich-output` | Chooses how `latexmk` output is displayed. Rich mode (default) streams structured progress updates via Rich; classic mode prints raw logs. |
| `--language TEXT` | Overrides the LaTeX language (BCP 47). |
| `--slot/-s VALUE` | Maps sections to template slots, identical to the behaviour described in [`texsmith convert`](convert.md#options). |
| `--markdown-extensions/-x VALUE` | Enables additional Markdown extensions. |
| `--disable-extension/-d VALUE` | Disables default Markdown extensions. |
| `--bibliography/-b PATH` | Merges external BibTeX files. |

## How the Build Pipeline Works

1. The source document is converted to HTML (if Markdown) and normalised according to the selected options.
2. TeXSmith renders LaTeX fragments, applies the chosen template, and writes a `.tex` file into the output directory.
3. The command configures dedicated TeX cache directories so that builds remain isolated.
4. `latexmk -pdf` runs inside the output directory using the engine specified by the template.
5. On success, the resulting PDF sits next to the generated `.tex`. If citations are present, a trimmed `texsmith-bibliography.bib` is produced as well.

## External Requirements

- `latexmk` must be available on the system `PATH` (install it via TeX Live, MikTeX, or a similar distribution).
- Optional converters may require `cairosvg`, `pillow`, `requests`, Docker, or diagram CLI tools. Missing dependencies trigger explicit errors unless fallbacks are allowed.

!!! tip "Inspect available templates"
    Use `texsmith template info <template>` to inspect metadata for an installed
    template package. Pair the output with your template documentation to learn
    about slot layouts and engine requirements. The
    [High-Level Workflows](../api/high-level.md) page dives deeper into template
    management from Python.

## Usage Examples

### Produce a PDF with a template

```bash
texsmith build docs/book.md \
  --template article \
  --output-dir build \
  --bibliography references/library.bib
```

Outputs include:

- `build/book.tex` – intermediate LaTeX generated by TeXSmith.
- `build/book.pdf` – compiled PDF from `latexmk`.
- `build/texsmith-bibliography.bib` – trimmed references matching the citations.

### Monitor compilation with Rich

```bash
texsmith build docs/manual.md \
  --template handbook \
  --output-dir build \
  --rich-output
```

`--rich-output` (the default) provides progress bars and colourised logs while `latexmk` runs. Pass `--classic-output` if you prefer raw terminal output or want to pipe logs elsewhere.
