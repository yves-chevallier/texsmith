\RequirePackage{luatex85}
\documentclass\BLOCK{ if documentclass_options }[\VAR{documentclass_options}]\BLOCK{ endif }{Definitions/mdpi}

\usepackage{fontspec}
\usepackage{microtype}
\usepackage{luacolor}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{array}
\usepackage{algorithm}
\usepackage{algorithmicx}
\usepackage{algpseudocode}
\usepackage{mathtools}
\usepackage{cleveref}
\usepackage[listings, breakable, skins]{tcolorbox}
\usepackage{listings}
\usepackage{natbib}

\tcbuselibrary{skins, breakable}
\setlength{\parindent}{1em}
\setlength{\parskip}{0.5em}

\lstdefinestyle{mdpi}{
  basicstyle=\ttfamily\footnotesize,
  numbers=none,
  breaklines=true,
  breakatwhitespace=false,
  showstringspaces=false,
  columns=fullflexible,
  keepspaces=true,
  tabsize=4,
  literate={ε}{{\ensuremath{\varepsilon}}}1
           {ε̇}{{\ensuremath{\dot{\varepsilon}}}}1
           {⁻}{{\ensuremath{^{-}}}}1
           {°}{{\ensuremath{^{\circ}}}}1
           {¹}{{\ensuremath{^{1}}}}1
           {²}{{\ensuremath{^{2}}}}1,
}

\newtcblisting[auto counter,number within=section]{code}[4][]{%
  breakable,
  listing engine=listings,
  listing only,
  enhanced,
  colback=white,
  pad at break*=1mm,
  toptitle=0.15em,
  bottomtitle=0.1em,
  boxrule=0mm,
  frame hidden,
  top=1mm,
  bottom=1mm,
  listing options={
      style=mdpi,
      language=#2,
      #4
    },
  title={#3},
  #1
}

\raggedbottom

\BLOCK{ for orcid in orcid_commands }
\newcommand{\orcidauthor\VAR{orcid.command}}{\VAR{orcid.identifier}}
\BLOCK{ endfor }

\Title{\VAR{title}}
\BLOCK{ if title_citation }\TitleCitation{\VAR{title_citation}}\BLOCK{ endif }
\BLOCK{ if short_title }\newcommand{\TitleCitationText}{\VAR{short_title}}\BLOCK{ endif }

\Author{\VAR{author_block}}
\BLOCK{ if author_names }\AuthorNames{\VAR{author_names}}\BLOCK{ endif }
\BLOCK{ if author_citation }\AuthorCitation{\VAR{author_citation}}\BLOCK{ endif }

\address{
\BLOCK{ for affiliation in affiliation_entries }$^{\VAR{affiliation.id}}$ \quad \VAR{affiliation.text}\BLOCK{if affiliation.emails} (\VAR{affiliation.emails})\BLOCK{endif}\BLOCK{if not loop.last}\\\BLOCK{endif}
\BLOCK{ endfor }
}

\BLOCK{ if correspondence_entry }\corres{\VAR{correspondence_entry}}\BLOCK{ endif }
\BLOCK{ if first_note }\firstnote{\VAR{first_note}}\BLOCK{ endif }
\BLOCK{ if second_note }\secondnote{\VAR{second_note}}\BLOCK{ endif }
\BLOCK{ for note in extra_notes }\VAR{note.command}{\VAR{note.text}}\BLOCK{ endfor }

\BLOCK{ if simple_summary }\simplesumm{\VAR{simple_summary}}\BLOCK{ endif }
\BLOCK{ if conference }\conference{\VAR{conference}}\BLOCK{ endif }
\BLOCK{ if featured_application }\featuredapplication{\VAR{featured_application}}\BLOCK{ endif }
\BLOCK{ if dataset }\dataset{\VAR{dataset}}\BLOCK{ endif }
\BLOCK{ if dataset_license }\datasetlicense{\VAR{dataset_license}}\BLOCK{ endif }
\BLOCK{ if key_contribution }\keycontribution{\VAR{key_contribution}}\BLOCK{ endif }
\BLOCK{ if encyclopedia_def }\encyclopediadef{\VAR{encyclopedia_def}}\BLOCK{ endif }

\BLOCK{ if abstract }\abstract{\VAR{abstract}}\BLOCK{ endif }
\BLOCK{ if keywords }\keyword{\VAR{keywords_joined}}\BLOCK{ endif }

\begin{document}

\maketitle

\BLOCK{ if featured_graphic }
\begin{figure}[H]
  \centering
  \includegraphics{\VAR{featured_graphic}}
  \caption{Graphical abstract}
\end{figure}
\BLOCK{ endif }

\VAR{frontmatter}

\VAR{mainmatter}

\VAR{backmatter}

\BLOCK{ if acknowledgments }\acknowledgments{\VAR{acknowledgments}}\BLOCK{ endif }
\BLOCK{ if funding }\funding{\VAR{funding}}\BLOCK{ endif }
\BLOCK{ if data_availability }\dataavailability{\VAR{data_availability}}\BLOCK{ endif }
\BLOCK{ if conflicts }\conflictsofinterest{\VAR{conflicts}}\BLOCK{ endif }
\BLOCK{ if other_sections }
\BLOCK{ for section in other_sections }
\section{\VAR{section.title}}
\VAR{section.content}
\BLOCK{ endfor }
\BLOCK{ endif }

\BLOCK{ if bibliography_style }\bibliographystyle{\VAR{bibliography_style}}\BLOCK{ endif }
\BLOCK{ if bibliography }\bibliography{\VAR{bibliography}}\BLOCK{ endif }

\end{document}
